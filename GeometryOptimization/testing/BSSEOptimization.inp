%Compound
  # This is a testing file for BSSEOptimization file
  #   It needs the water_dimer.xyz file where
  #   one water of the dimer is just ghost atoms. The
  #   xyz file should be in the current directory
  # Be carefull this file also needs in addition the file
  #   BSSEGradient.cmp 
  # For this script we should also adjust the baseFilename
  #
  # The file will copy the compound script from the parent
  #   directory, create an ORCA input file and run it
  Variable fp;
  Variable script_basename = "BSSEOptimization";
  Variable orca_input_name, orca_output_name, script_name;
  Variable orca_command = "orca";
  Variable script_directory = "..";
  Variable my_molecule = "water_dimer.xyz";

  #1. Create names based on the basename
  write2String(script_name, "%s.cmp", script_basename);
  #write2String(orca_input_name, "run.inp", script_basename);
  #write2String(orca_output_name, "run.out", script_basename);
  write2String(orca_input_name, "test_%s.inp", script_basename);
  write2String(orca_output_name, "test_%s.out", script_basename);

  #2. Create the running ORCA file
  fp = openFile(orca_input_name, "w");
  write2File(fp, "\%Compound \"%s\"\n", script_name);
  write2File(fp, "   with\n");
  write2File(fp, "      molecule = \"%s\"\;\n", my_molecule);
  write2File(fp, "      baseFilename = \"test_%s\"\;\n", script_basename); 
  write2File(fp, "EndRun\n");
  closeFile(fp);

  #3. Copy the compound script
  syscmd("cp %s/%s .", script_directory, script_name);
 
  #3b. Here we need in addition the file BSSEGradient.cmp
  #    We have to make a relevant hard wired copy guessing it is 
  #    in the expected directory
  syscmd("cp ../../BSSE/BSSEGradient.cmp .");

  #4. Run the new ORCA input
  syscmd(" %s %s > %s &", orca_command, orca_input_name, orca_output_name);
     
EndRun
